/*
               Банковская интегрированная система БИСквит
    Copyright: (C) 1992-2001 ТОО "Банковские информационные системы"
     Filename: pp-dpspr.p
      Comment: Инструменты для расчета процентов и налогов по частным вкладам
   Parameters:
         Uses:
      Used by: 
      Created: 11/04/2005 MIOA
     Modified: 
  Last change:
*/

form "~n@(#) pp-dpspr.p 1.0 MIOA 11/04/2005"
with frame sccs-id stream-io width 250.

{globals.i}
{dpsproc.def}
{ksh-defs.i}

{intrface.get dps}
{intrface.get date}
{intrface.get dpspc}
{intrface.get instrum}
{intrface.get xclass}
{intrface.get db2l}
{meth-dps-stav.i}
{f_for_t.i {&*} &In-Handle_PROC = "IN h_dpspc"}
{setgetdt.i 
   &SET_DATA_PERCENT = YES 
   &GET_DATA_PERCENT = YES 
}

&GLOBAL-DEFINE VERY_FAR_FUTURE_DATE 01/01/3000 /* дата "очень далекое будущее" */

/******************************************************************************/
/*                  ТАБЛИЦЫ И ПРОЦЕДУРА ДЛЯ НАЧИСЛЕНИЯ ПРОЦЕНТОВ              */
/*            Вспомогательный блок для расчета процентных сумм и ставок       */
/******************************************************************************/
/* Процедура начисления процентов 
   
   NOTE: Здесь имеется некоторая избыточность. 
         А именно - nachkin.p становится внутренней процедурой библиотеки.
         
         Изначально это делалось, чтобы из основного модуля из из nachkin
         был доступ к таблице rep-tt. Теперь таблица rep-tt изничтожена,
         вместо нее nachkin-tt, которая GLOBAL-SHARED, поэтому таких танцев
         вокруг нее не нужно. 
         
         Со временем эта избыточность будет устранена, но я еще не знаю,
         каким способом. Поэтому я пока ее оставила. (c)mioa

*/

DEFINE VARIABLE vNatCurrChar AS CHARACTER  NO-UNDO.
DEFINE VARIABLE vReserv      AS LOGICAL    NO-UNDO.
DEFINE VARIABLE vComm-rate   AS DECIMAL    NO-UNDO.

DEF STREAM dbgStream.

&GLOBAL-DEFINE use-tt
{dpspr.def &inlib} /* Здесь подключается таблица nachkin-tt */
PROCEDURE local_nachkin:
  {nachkin.p}
END PROCEDURE. /* END OF local_nachkin */

ASSIGN 
   vNatCurrChar = FGetSetting("КодНацВал", ?, "{&in-NC-Code}")
   vReserv = (GetSysConf("TypeNach") EQ "Резервирование")
   .
IF vReserv THEN
DO:
   /* Загрузка идет таким образом, чтобы избежать обьявления функций, 
   ** которые при vReserv - нет будут декларироваться, но не описываться */
   DEF VAR h_nachd AS HANDLE NO-UNDO.
   RUN LoadInterface IN h_base ("nachd", output h_nachd).
   IF NOT VALID-HANDLE(h_nachd) THEN RETURN.
   THIS-PROCEDURE:ADD-SUPER-PROCEDURE (h_nachd).
END.

{getcomm.i}

/******************************************************************************/
/*                                 ПРОЦЕДУРЫ                                  */
/******************************************************************************/
{dpspr_tax.i}  /* Процедуры для начисления налогов */
{dpspr_perc.i} /* Процедуры для расчета процентов  */
