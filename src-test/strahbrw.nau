/*
               Банковская интегрированная система БИСквит
    Copyright: (C) 1992-2010 ЗАО "Банковские информационные системы"
     Filename: strahbrw.NAU
      Comment: Получатели страховых премий - выбор по F1
   Parameters:
         Uses:
      Used by:
      Created:    
     Modified:   
*/

IF FRAME-FIELD EQ "mCustID" AND 
   mCustCat:SCREEN-VALUE IN FRAME edit NE ""  AND mCustCat:SCREEN-VALUE IN FRAME edit NE "Р" AND mCustCat:SCREEN-VALUE IN FRAME edit NE "О" THEN
DO:
   pick-value = "".
   RUN browseld (ENTRY(LOOKUP (mCustCat:SCREEN-VALUE IN FRAME edit,"Ч,Ю"), 
                       "person,cust-corp"),"","","",4).
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" THEN DO:
      DISPLAY pick-value @ mCustID WITH FRAME edit.
      RUN FillSubj.
   END.
END.
ELSE IF FRAME-FIELD EQ "mRaschAcct" THEN  /* расчетный счет */
DO:
   pick-value = "".
   RUN browseld ("acct","","","",4).
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" AND pick-value <> ? AND pick-value <> "" THEN DO:
      RUN FillAcct(INPUT pick-value).
   END.
END.

ELSE IF FRAME-FIELD EQ "misc" AND ( FRAME-INDEX EQ 1 OR FRAME-INDEX EQ 3) THEN
DO:
   pick-value = "".
   RUN browseld ("banks",
    "return" + CHR(1) +
                "SetFirstFrm",
                "bank-id" + CHR(1) +
                "2",
                "",
                4).
   
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" THEN DO:
       FIND FIRST banks WHERE banks.bank-id = INT64(pick-value) NO-LOCK NO-ERROR.
       IF AVAIL banks THEN DO: 
           code.{&BankName}:SCREEN-VALUE IN FRAME edit = trim(banks.name).
           FIND FIRST banks-code WHERE banks-code.bank-id = banks.bank-id AND banks-code.bank-code-type = "МФО-9" NO-LOCK NO-ERROR.
           IF AVAIL banks-code THEN code.{&BankBIC}:SCREEN-VALUE IN FRAME edit = banks-code.bank-code.
       END.
   END.
END.

ELSE IF FRAME-FIELD EQ "misc" AND FRAME-INDEX EQ 5 THEN
DO:
   pick-value = "".
   RUN codelay.p ("КодДокум","КодДокум","Вид документа",4).
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" THEN DO:
       code.{&DocType}:SCREEN-VALUE IN FRAME edit = string(pick-value).
   END.
END.

ELSE IF FRAME-FIELD EQ "misc" AND FRAME-INDEX EQ 7 THEN
DO:
   pick-value = "".
   RUN calend.p.
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" THEN DO:
       code.{&DocOpenDate}:SCREEN-VALUE IN FRAME edit = string(Date(string(pick-value)),"99.99.9999").
   END.
END.

ELSE IF FRAME-FIELD EQ "kind" THEN
DO:
   pick-value = "".
   RUN calend.p.
   IF KEY-FUNCTION(LAST-KEY) NE "END-ERROR" THEN DO:
       code.{&BirthDay}:SCREEN-VALUE IN FRAME edit = string(Date(string(pick-value)),"99.99.9999").
   END.
END.












