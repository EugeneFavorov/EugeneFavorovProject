/* переменные для подсчета итогов */
DEF VAR mSum-b-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма баланс*/
DEF VAR mSum-o-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма внебаланс*/
DEF VAR mSum-val-b-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма валюта баланс*/
DEF VAR mSum-val-o-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма валюта внебаланс*/

DEF VAR mSum-e-b-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма электронно баланс*/
DEF VAR mSum-e-o-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма электронно внебаланс*/
DEF VAR mSum-e-val-b-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма электронно валюта баланс*/
DEF VAR mSum-e-val-o-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма электронно валюта внебаланс*/

DEF VAR mKas-b-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма кассовые баланс*/
DEF VAR mKas-o-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма кассовые внебаланс*/
DEF VAR mKas-val-b-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма кассовые валюта баланс*/
DEF VAR mKas-val-o-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма кассовые валюта внебаланс*/

DEF VAR mDd-b-all        LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма документы дня баланс*/
DEF VAR mDd-o-all        LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма документы дня внебаланс*/
DEF VAR mDd-val-b-all    LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма документы дня валюта баланс*/
DEF VAR mDd-val-o-all    LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма документы дня валюта внебаланс*/ 

DEF VAR mAg-p-b-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские бумага баланс*/
DEF VAR mAg-p-o-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские бумага внебаланс*/
DEF VAR mAg-p-val-b-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские бумага валюта баланс*/
DEF VAR mAg-p-val-o-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские бумага валюта внебаланс*/

DEF VAR mOt-p-b-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет бумага баланс*/
DEF VAR mOt-p-o-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет бумага внебаланс*/
DEF VAR mOt-p-val-b-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет бумага валюта баланс*/
DEF VAR mOt-p-val-o-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет бумага валюта внебаланс*/

DEF VAR mHoz-p-b-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. бумага баланс*/
DEF VAR mHoz-p-o-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. бумага внебаланс*/
DEF VAR mHoz-p-val-b-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. бумага валюта баланс*/
DEF VAR mHoz-p-val-o-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. бумага валюта внебаланс*/

DEF VAR mAg-e-b-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские электронно баланс*/
DEF VAR mAg-e-o-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские электронно внебаланс*/
DEF VAR mAg-e-val-b-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские электронно валюта баланс*/
DEF VAR mAg-e-val-o-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма агентские электронно валюта внебаланс*/

DEF VAR mOt-e-b-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет электронно баланс*/
DEF VAR mOt-e-o-all      LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет электронно внебаланс*/
DEF VAR mOt-e-val-b-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет электронно валюта баланс*/
DEF VAR mOt-e-val-o-all  LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма отчет электронно валюта внебаланс*/

DEF VAR mHoz-e-b-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. электронно баланс*/
DEF VAR mHoz-e-o-all     LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. электронно внебаланс*/
DEF VAR mHoz-e-val-b-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. электронно валюта баланс*/
DEF VAR mHoz-e-val-o-all LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма хоз.дог. электронно валюта внебаланс*/

DEF VAR mBuh-b-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма бугалтерские баланс*/
DEF VAR mBuh-o-all       LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма бугалтерские внебаланс*/
DEF VAR mBuh-val-b-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма бугалтерские валюта баланс*/
DEF VAR mBuh-val-o-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма бугалтерские валюта внебаланс*/

DEF VAR mBuh-aut-b-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма автоматические транзакции баланс*/
DEF VAR mBuh-aut-o-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма автоматические транзакции внебаланс*/
DEF VAR mBuh-auv-b-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма автоматические транзакции валюта баланс*/
DEF VAR mBuh-auv-o-all   LIKE op-entry.amt-rub INIT 0.00 NO-UNDO. /* общая сумма автоматические транзакции валюта внебаланс*/
/**/

DEF TEMP-TABLE tt-op-day NO-UNDO     /*проводки за операционный день*/
    FIELD op-cid    AS   RECID              /*op*/
    FIELD ope-cid   AS   RECID              /*op-entry*/
    FIELD city-id   AS   INTEGER            /*гб или нет*/
    FIELD kko       AS   CHARACTER          /*код отделения*/
    FIELD currency  LIKE op-entry.currency  /*валюта*/
    FIELD acct-cat  LIKE op-entry.acct-cat  /*баланс\внебаланс*/
    FIELD razdel    AS   CHARACTER          /*раздел (k - касса, b - баланс)*/
    FIELD save-type AS   CHARACTER          /*вид хранения (p - бумага, e - электронно)*/
    FIELD shiv      AS   CHARACTER          /*вид сшива (Агент,Хоздок,Подотчет,Докдн)*/ 
    FIELD auto-t    AS   LOGICAL            /*автоматическая транзакция*/
    FIELD acct-db   LIKE op-entry.acct-db   /*дебит*/
    FIELD acct-cr   LIKE op-entry.acct-cr   /*кредит*/
    FIELD doc-num   LIKE op.doc-num         /*номер документа*/
    FIELD amt-rub   LIKE op-entry.amt-rub   /*сумма в рублях*/
    FIELD user-id   LIKE op.user-id         /*ввел*/
    FIELD op 		LIKE op.op              /**/
    FIELD op-kind 	LIKE op.op-kind         /*код транзакции*/
    FIELD doc-date	LIKE op.doc-date        /*дата создания*/
    INDEX op-day op-cid ope-cid kko razdel.

DEF TEMP-TABLE tt-day-itog NO-UNDO    /*итог*/ 
    FIELD city      AS   CHARACTER          /**/
    FIELD kko       AS   CHARACTER          /*код отделения*/
    FIELD currency  LIKE op-entry.currency  /*валюта*/
    FIELD acct-cat  LIKE op-entry.acct-cat  /*баланс\внебаланс*/
    FIELD razdel    AS   CHARACTER          /*раздел (касса\баланс)*/
    FIELD save-type AS   CHARACTER          /*вид хранения*/
    FIELD itog      LIKE op-entry.amt-rub   /*итоговая сумма(в рублях)*/
    FIELD auto-t    AS   LOGICAL            /*автоматическая транзакция*/
    FIELD shiv      AS   CHARACTER          /*вид сшива (Агент,Хоздок,Подотчет,Докдн)*/ 
    INDEX day-itog city kko razdel.

DEF TEMP-TABLE tt-kko    /*список отделений в титульнике*/
    FIELD city-id   AS CHARACTER            /*порядок сортировки*/   
    FIELD city      AS CHARACTER            /*название отделения*/   
    FIELD kko       AS CHARACTER            /*код подразделения*/
    FIELD shiv      AS CHARACTER            /*виды сшива (Агент,Хоздок,Подотчет,Докдн)*/   
    INDEX prr city-id kko.

FUNCTION GetDateString RETURN CHARACTER PRIVATE(INPUT iDate AS DATE):
    IF iDate = ? THEN
        RETURN ?.
        RETURN ('\"' + STRING(DAY(iDate)) + '\" ' + ENTRY(MONTH(iDate), "января,февраля,марта,апреля,мая,июня,июля,августа,сентября,октября,ноября,декабря") + " " + STRING(YEAR(iDate)) + " г.").
END FUNCTION.