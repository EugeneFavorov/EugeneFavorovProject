/* На форму запуска отчета необходимо добавить следующие параметры помимо периода:
     <Клиент> - выбор клиента из списков юридических и физический лиц;
     <Код вида валютной операции> - выбор значения из классификатора КодОпВал117.
---------------------------------------------------------------------------------- */
DEFINE VARIABLE mFrameCustCut AS CHARACTER         NO-UNDO.
DEFINE VARIABLE mFrameCustId  AS CHARACTER         NO-UNDO.
DEFINE VARIABLE mFrameKodOp   AS CHARACTER         NO-UNDO.
DEFINE VARIABLE numrec        AS DECIMAL INIT 0    NO-UNDO.

FORM
   mFrameCustCut 
      VIEW-AS COMBO-BOX LIST-ITEMS "","Ю","Ч" 
      LABEL "Тип клиента"  AT 2 SKIP
   mFrameCustId  
      VIEW-AS FILL-IN SIZE 6  BY 1            
      LABEL "Клиент"       AT 7 SKIP
   mFrameKodOp   
      FORMAT "x(100)"
      VIEW-AS FILL-IN SIZE 30 BY 1            
      LABEL "Коды вал.оп."      SKIP
WITH FRAME persfrm TITLE "Настройки отчета" CENTERED KEEP-TAB-ORDER OVERLAY ROW 10 SIDE-LABELS.

ON "F1" OF mFrameCustId IN FRAME persfrm DO:
DO TRANS:
   CASE (mFrameCustCut:SCREEN-VALUE):
      WHEN "Ч" THEN
         RUN browseld.p ("person","","","",4).
      WHEN "Ю" THEN
         RUN browseld.p ("cust-corp","","","",4).
   END CASE.
   IF (LASTKEY EQ 13 OR LASTKEY EQ 10) AND pick-value NE ? THEN
      mFrameCustId:SCREEN-VALUE = pick-value.
END.
END.

ON "F1" OF mFrameKodOp IN FRAME persfrm DO:
DO TRANS:
   RUN pclass117i.p ("КодОпВал117","КодОпВал117","КОД ВИДА ВАЛЮТНОЙ ОПЕРАЦИИ ПО 117-И",4).
   IF (LASTKEY EQ 13 OR LASTKEY EQ 10) AND pick-value NE ? THEN DO:
      {additem.i mFrameKodOp:SCREEN-VALUE pick-value}
   END.
END.
END.
ON "ENTER" OF mFrameCustCut IN FRAME persfrm
DO:
   APPLY "TAB" TO SELF.
END.
ON 'GO' OF FRAME persfrm DO:
   ASSIGN
      mFrameCustCut = mFrameCustCut:SCREEN-VALUE
      mFrameCustId  = mFrameCustId:SCREEN-VALUE
      mFrameKodOp   = mFrameKodOp:SCREEN-VALUE
   .
END.
PAUSE 0.

UPDATE
   mFrameCustCut
   mFrameCustId
   mFrameKodOp
WITH FRAME persfrm.

HIDE FRAME persfrm.
/* $LINTENV ='1ut' */
/* $LINTVSS ='$/ws2-tst/bq/' */
/* $LINTDATE='21/07/2015 10:44:20.901+04:00' */
/* $LINTUSER='stss' */
/* $LINTMODE='1' */
/* $LINTFILE='ree-117i.sel' */
/*prosignCEI/xDQmUZV1chjzilpY7Q*/